<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>SSH简介 | 晨钟暮鼓</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="Gavin&#39;s Blog"><link rel="prev" href="http://belldrum.com/2020/02/0003-ali-cloud-server/" /><link rel="next" href="http://belldrum.com/2020/02/0005-linux-user-management/" /><link rel="canonical" href="http://belldrum.com/2020/02/0004-ssh-introduction/" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff"><meta property="og:title" content="SSH简介" />
<meta property="og:description" content="虽然一直在使用SSH连接服务器，但是对于SSH连接的原理却没有深究，只是大体了解是使用了非对称加密技术对传输信息进行了加密。搜资料的时候顺手翻到了一篇博文，介绍的还比较详细，特转载保存。本文转自链接，作者是FancySeeker。
本文主要介绍了SSH的连接认证原理以及SSH的配置和使用。
SSH简要介绍
SSH的英文全称为Secure Shell，是IETF（Internet Engineering Task Force）的Network Working Group所制定的一族协议，其目的是要在非安全网络上提供安全的远程登录和其他安全网络服务。用于在主机之间建立起安全连接, 并加密传输内容, 以达到安全的远程访问, 操作以及数据传输的目的。
SSH主要有两个特点: 1. 安全性 2. 传输速度快
为什么要强调SSH的安全特性, 因为传统的网络服务程序，如 FTP、POP 和 Telnet 其本质上都是不安全的；因为它们在网络上用明文传送数据、用户帐号和用户口令，很容易受到中间人（man-in-the-middle）攻击方式的攻击。就是存在另一个人或者一台机器冒充真正的服务器接收用户传给服务器的数据，然后再冒充用户把数据传给真正的服务器。 而 SSH 是目前较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。透过 SSH 可以对所有传输的数据进行加密，也能够防止 DNS 欺骗和 IP 欺骗。
SSH的传输速度快是因为SSH传输的数据都是经过压缩的, 自然传输速度快。
SSH认证原理
在介绍SSH具体的认证原理之前, 先简单的介绍下关于公钥和密钥加密的概念。所谓的公钥加密（public-key cryptography），或非对称密钥加密（asymmetric key cryptography） 是一类广泛使用的加密算法。这类算法使用一对（pair）密钥即公钥（public key）和私钥（private key）。 其中公钥可以随便分发，只用于加密（encryption），私钥则只由一人持有，只用于解密。通过公钥加密过的密文使用密钥可以轻松解密, 但根据公钥来猜测私钥却十分困难。
因此, 我们可以很容易的发现这么一个事实, 一个消息在用公钥加密后, 哪怕在传输中被人截获, 如果没有私钥, 是无法解密获得其内容的, 只有拥有私钥的人才能成功解密消息。所以私钥应该由消息的接收方紧紧攥在手里, 不应让他人得知。
公钥加密的关键点在于，一方面，公钥加密是可逆的，但是不能用公钥推断出私钥。显然数学上，已知一个公钥是能够算出对应私钥的，但是只要设计足够好的加密算法（以及使用足够复杂的密钥对），使得不能在可以接受的时间内破译即可。
RSA是一种常见的公钥加密算法。RSA的工作原理依赖于如下事实：破译RSA私钥需要对某些极大的整数进行因数分解，而目前尚未找到快速的对极大整数作因数分解的算法。换言之，如果有人找到了这样的算法，那么全世界的 RSA 加密都会失效。
RSA是由Ron Rivest，Adi Shamir, Leonard Adleman三人在1978年首次提出的。三人并因此项工作荣获了2002年Turing Award。Rivest还是算法导论的作者之一，书中在31章对RSA系统的原理进行了简要说明，系统实现中利用到了数论中的Euler-Fermat theorem。
一个基于RSA的公钥大概如下


1
2
3
4
5


ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAvSkEZ0fKXRqQ/DkjCfsAETsQgV8OR/RVQmwBk/J5IWoknf8Dr
y5kOs&#43;1bnx9zaf8oIcVuXf0jRxTccLBOXiReFJE4aD2rWO33sqA0M4qP1ESYhsU4yokRA0IMDJ62JUv2cWVJg
GpeQriol2t7mH8E6aB8OiJ&#43;NgRbh6&#43;/0LbtQs40VA2&#43;W5PtaBwT4sjv9LOHIdzQcsEeCM8MIHqmXHst7/JuVI
i7wLCxB7Ur8qtwZ2/Ii8Ckjfo6mikWmSh6mRMq9qn0FkMkPCcpm8o4f1zJWOuf&#43;RnjPpopFTqIa8JssMHJMuQ
cCm3EHDkBHjLk/SkidWOzqOtSvUeGKieWiijuw== username@localhost.localdomain


与之配对的私钥形如下


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23


-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAvSkEZ0fKXRqQ/DkjCfsAETsQgV8OR/RVQmwBk/J5IWoknf8D
ry5kOs&#43;1bnx9zaf8oIcVuXf0jRxTccLBOXiReFJE4aD2rWO33sqA0M4qP1ESYhsU
4yokRA0IMDJ62JUv2cWVJgGpeQriol2t7mH8E6aB8OiJ&#43;NgRbh6&#43;/0LbtQs40VA2
&#43;W5PtaBwT4sjv9LOHIdzQcsEeCM8MIHqmXHst7/JuVIi7wLCxB7Ur8qtwZ2/Ii8C
kjfo6mikWmSh6mRMq9qn0FkMkPCcpm8o4f1zJWOuf&#43;RnjPpopFTqIa8JssMHJMuQ
cCm3EHDkBHjLk/SkidWOzqOtSvUeGKieWiijuwIBIwKCAQEAjITesx9jIJdkY5go
qFQOrbbZD6Wy1l27ra9RoRqF3k7ZX2z7bDEXQaGcuHm8iiUEzwVDVpOfuUg9/LyP
icdHffP4p5wk9dUMPxoWjHvk3pP/BwzNsBCtOd3LkYSVxXYji9SaroTkS0nqL3jK
WVAaV72FGVxJPINAJer0SJgQ7OJ7f0kZJYoPwG0VpMTLOsmulH7/M5e9i&#43;kwDLmH
&#43;TMvJ3y8gXjc/Sj5UqN/JQIY&#43;h07UxYGvoju/isqFHh8OmahsjJ3Nb3QsUEkC/Kj
cKG2K&#43;mUzTe/4/XQuqMadrjX82QF2b2gL&#43;cdvUAwLn55boXmrtUzxEPo4xxiDNzY
AbYxSwKBgQDxIkaa&#43;EPSJXYej/5YzJLJLVsnb9ygqe/0fM0x022J6Z&#43;0Yq9AIwJ7
N7dvMgNSROLoJ17Oij/N7aoiAZy1KHg1vOoqx6T6BClay8I1&#43;dOsbY6Fi0QbkZeI
Rr6CDueq5PBR8j/oghNhQeFfJUEICBFU6Z7&#43;uFwxuAtQqqdFHyDhSwKBgQDI0nX6
Jz9oW&#43;Y&#43;dXAvhpL8Yln0R45ufiqatkTQgGbeZ70XlKeR7VzQiXecy/XDteJCMlnv
4BhjHL967nSAmrCza13I3eXIYxbzypeNC57bVVXM9BBTg5f4nWwTN&#43;I8Gd/BA5Y8
mekQPBuSyAOp7ULAecjKZrD9Jhw1vybT/aYxUQKBgQDcdxv7ZqRoXMPEK&#43;E7PrIX
BOWgZkYPPEkaC7RKz&#43;8fAXwSo15mhmirK6BlqhGqTZxB&#43;BwqjQcirWhZmxLuxeo/
wqo1vdiqEm7z7X5dPC8&#43;kA1G5bqc3OJQtbV&#43;OYNaaupZjQc6&#43;pVgPDvEtFi24s4E
fdMyB6S/vjY7H67gHHXVSwKBgQC3m9mUQSQHpHq8wyS9vN4olG&#43;AQWxHw88uXYC&#43;
oUgbzI&#43;gh&#43;mp/ZawCKff0GurnvrALgkV1DON0SQYn4B1lL7P7SKLw5BCLrXmNZHg
Cp/eeegL19RpnOK3a1t/SQlbhV7cWw0ENPJX/HD7OocBwvszoouxvPmW/kWte5E2


SSH 连接是C/S模型，客户端发出连接申请，服务器对客户端进行验证，再考虑是否接受连接申请。
SSH认证过程
SSH提供了两种认证的方式, 分别为:
Password认证
即账号口令验证，SSH的实现方式是，

客户端向 ssh 服务器发出请求，服务器将自己的公钥返回给客户端；
客户端用服务器的公钥加密自己的登录密码，再将信息发送给服务器；
服务器接收到客户端传送的密码，用自己的私钥解码，如果结果正确，则同意登录，建立起连接。

这种方式还是存在漏洞，中间人可以假扮成服务器，骗取客户端的密码。而且在每次登陆的时候都需要输入密码，所以一般不采用该验证方式。
Public Key认证
Public Key认证利用公钥私钥对进行认证，在请求连接时不需要输入密码，并且由于整个请求连接和通信过程全程加密，因此安全性高。
SSH协议第二版中有RSA和DSA两种算法认证，其中RSA加密验证比较常用。
RSA加密验证方式，充分利用了非对称加密体系的优势，不需要在网络传输密码，完全杜绝了中间人攻击的可能。
认证的具体步骤如下:

准备工作


客户端先使用 ssh-keygen 命令，生成公钥和私钥。按照默认配置，私钥会被保存在~/.ssh/id_rsa中，公钥则在~/.ssh/id_rsa.pub中。
客户端通过安全的方式（一般通过scp/Secure Copy Protocol）方式或者U盘拷贝的方式)将公钥发送给服务器。在服务器端, 将客户端发的公钥写入到~/.ssh/authorized_keys文件末尾。（其实公钥和私钥不是必须在客户端生成, 在服务器端生成也是可以的, 在哪生成的对公钥和私钥并没有任何影响, 重要的是二者是配对的, 而准备阶段其实是要保证这么一个事实, 即服务器端握有公钥, 并在对应账户的家目录下的.ssh/authorized_keys文件中保存以便验证程序访问。请求端握有私钥。 至于为什么要将公钥和私钥这么分配, 接下来将会解释）


建立连接
在建立连接的时候，涉及到2对密钥，其中一对为准备阶段产生并分配好的密钥对，另一对为服务器在接收到一个连接请求时生成的密钥对。为了讲述方便，我们将这两组密钥对表示如下
|Symbol|Description|
|:-:|:-:|
|PubC|客户端密钥对应的公钥|
|PrvC|客户端握有的私钥|
|PubS|服务器端产生的公钥|
|PrvS|服务器端产生的私钥|



认证

服务器生成随机数（称之为challenge）x，并用PubC加密后生成结果s(x)，发送给客户端；
客户端使用PrvC解密s(x)得到x，再将x用PubS加密发送回服务器端；
服务器端使用PrvS解密得到x，进行核对, 如果正确则链接正式成立。



通信加密
在请求连接前，服务器端和客户端拥有的密钥为
|Server|Client|
|:-:|:-:|
|PubC|PrvC|

客户端发出申请。服务器会产生一组session密钥对，即PubS和PrvS。
此时服务器端和客户端拥有的密钥如下
|Server|Client|
|:-:|:-:|
|PubC|PrvC|
|PubS||
|PrvS||
服务器端利用客户端的公钥PubC对session公钥PubS进行加密后发送给客户端；
客户端用自己的密钥PrvC解密信息，得到session公钥PubS，此时服务器端和客户端拥有的密钥如下
|Server|Client|
|:-:|:-:|
|PubC|PubS|
|PubS|PrvC|
|PrvS||
之后的数据交互，都通过对方方公钥加密，对方收到信息后，用其私钥解密，实现安全加密过程。


" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://belldrum.com/2020/02/0004-ssh-introduction/" />
<meta property="article:published_time" content="2020-02-12T21:24:11+08:00" />
<meta property="article:modified_time" content="2020-02-12T21:24:11+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SSH简介"/>
<meta name="twitter:description" content="虽然一直在使用SSH连接服务器，但是对于SSH连接的原理却没有深究，只是大体了解是使用了非对称加密技术对传输信息进行了加密。搜资料的时候顺手翻到了一篇博文，介绍的还比较详细，特转载保存。本文转自链接，作者是FancySeeker。
本文主要介绍了SSH的连接认证原理以及SSH的配置和使用。
SSH简要介绍
SSH的英文全称为Secure Shell，是IETF（Internet Engineering Task Force）的Network Working Group所制定的一族协议，其目的是要在非安全网络上提供安全的远程登录和其他安全网络服务。用于在主机之间建立起安全连接, 并加密传输内容, 以达到安全的远程访问, 操作以及数据传输的目的。
SSH主要有两个特点: 1. 安全性 2. 传输速度快
为什么要强调SSH的安全特性, 因为传统的网络服务程序，如 FTP、POP 和 Telnet 其本质上都是不安全的；因为它们在网络上用明文传送数据、用户帐号和用户口令，很容易受到中间人（man-in-the-middle）攻击方式的攻击。就是存在另一个人或者一台机器冒充真正的服务器接收用户传给服务器的数据，然后再冒充用户把数据传给真正的服务器。 而 SSH 是目前较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。透过 SSH 可以对所有传输的数据进行加密，也能够防止 DNS 欺骗和 IP 欺骗。
SSH的传输速度快是因为SSH传输的数据都是经过压缩的, 自然传输速度快。
SSH认证原理
在介绍SSH具体的认证原理之前, 先简单的介绍下关于公钥和密钥加密的概念。所谓的公钥加密（public-key cryptography），或非对称密钥加密（asymmetric key cryptography） 是一类广泛使用的加密算法。这类算法使用一对（pair）密钥即公钥（public key）和私钥（private key）。 其中公钥可以随便分发，只用于加密（encryption），私钥则只由一人持有，只用于解密。通过公钥加密过的密文使用密钥可以轻松解密, 但根据公钥来猜测私钥却十分困难。
因此, 我们可以很容易的发现这么一个事实, 一个消息在用公钥加密后, 哪怕在传输中被人截获, 如果没有私钥, 是无法解密获得其内容的, 只有拥有私钥的人才能成功解密消息。所以私钥应该由消息的接收方紧紧攥在手里, 不应让他人得知。
公钥加密的关键点在于，一方面，公钥加密是可逆的，但是不能用公钥推断出私钥。显然数学上，已知一个公钥是能够算出对应私钥的，但是只要设计足够好的加密算法（以及使用足够复杂的密钥对），使得不能在可以接受的时间内破译即可。
RSA是一种常见的公钥加密算法。RSA的工作原理依赖于如下事实：破译RSA私钥需要对某些极大的整数进行因数分解，而目前尚未找到快速的对极大整数作因数分解的算法。换言之，如果有人找到了这样的算法，那么全世界的 RSA 加密都会失效。
RSA是由Ron Rivest，Adi Shamir, Leonard Adleman三人在1978年首次提出的。三人并因此项工作荣获了2002年Turing Award。Rivest还是算法导论的作者之一，书中在31章对RSA系统的原理进行了简要说明，系统实现中利用到了数论中的Euler-Fermat theorem。
一个基于RSA的公钥大概如下


1
2
3
4
5


ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAvSkEZ0fKXRqQ/DkjCfsAETsQgV8OR/RVQmwBk/J5IWoknf8Dr
y5kOs&#43;1bnx9zaf8oIcVuXf0jRxTccLBOXiReFJE4aD2rWO33sqA0M4qP1ESYhsU4yokRA0IMDJ62JUv2cWVJg
GpeQriol2t7mH8E6aB8OiJ&#43;NgRbh6&#43;/0LbtQs40VA2&#43;W5PtaBwT4sjv9LOHIdzQcsEeCM8MIHqmXHst7/JuVI
i7wLCxB7Ur8qtwZ2/Ii8Ckjfo6mikWmSh6mRMq9qn0FkMkPCcpm8o4f1zJWOuf&#43;RnjPpopFTqIa8JssMHJMuQ
cCm3EHDkBHjLk/SkidWOzqOtSvUeGKieWiijuw== username@localhost.localdomain


与之配对的私钥形如下


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23


-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAvSkEZ0fKXRqQ/DkjCfsAETsQgV8OR/RVQmwBk/J5IWoknf8D
ry5kOs&#43;1bnx9zaf8oIcVuXf0jRxTccLBOXiReFJE4aD2rWO33sqA0M4qP1ESYhsU
4yokRA0IMDJ62JUv2cWVJgGpeQriol2t7mH8E6aB8OiJ&#43;NgRbh6&#43;/0LbtQs40VA2
&#43;W5PtaBwT4sjv9LOHIdzQcsEeCM8MIHqmXHst7/JuVIi7wLCxB7Ur8qtwZ2/Ii8C
kjfo6mikWmSh6mRMq9qn0FkMkPCcpm8o4f1zJWOuf&#43;RnjPpopFTqIa8JssMHJMuQ
cCm3EHDkBHjLk/SkidWOzqOtSvUeGKieWiijuwIBIwKCAQEAjITesx9jIJdkY5go
qFQOrbbZD6Wy1l27ra9RoRqF3k7ZX2z7bDEXQaGcuHm8iiUEzwVDVpOfuUg9/LyP
icdHffP4p5wk9dUMPxoWjHvk3pP/BwzNsBCtOd3LkYSVxXYji9SaroTkS0nqL3jK
WVAaV72FGVxJPINAJer0SJgQ7OJ7f0kZJYoPwG0VpMTLOsmulH7/M5e9i&#43;kwDLmH
&#43;TMvJ3y8gXjc/Sj5UqN/JQIY&#43;h07UxYGvoju/isqFHh8OmahsjJ3Nb3QsUEkC/Kj
cKG2K&#43;mUzTe/4/XQuqMadrjX82QF2b2gL&#43;cdvUAwLn55boXmrtUzxEPo4xxiDNzY
AbYxSwKBgQDxIkaa&#43;EPSJXYej/5YzJLJLVsnb9ygqe/0fM0x022J6Z&#43;0Yq9AIwJ7
N7dvMgNSROLoJ17Oij/N7aoiAZy1KHg1vOoqx6T6BClay8I1&#43;dOsbY6Fi0QbkZeI
Rr6CDueq5PBR8j/oghNhQeFfJUEICBFU6Z7&#43;uFwxuAtQqqdFHyDhSwKBgQDI0nX6
Jz9oW&#43;Y&#43;dXAvhpL8Yln0R45ufiqatkTQgGbeZ70XlKeR7VzQiXecy/XDteJCMlnv
4BhjHL967nSAmrCza13I3eXIYxbzypeNC57bVVXM9BBTg5f4nWwTN&#43;I8Gd/BA5Y8
mekQPBuSyAOp7ULAecjKZrD9Jhw1vybT/aYxUQKBgQDcdxv7ZqRoXMPEK&#43;E7PrIX
BOWgZkYPPEkaC7RKz&#43;8fAXwSo15mhmirK6BlqhGqTZxB&#43;BwqjQcirWhZmxLuxeo/
wqo1vdiqEm7z7X5dPC8&#43;kA1G5bqc3OJQtbV&#43;OYNaaupZjQc6&#43;pVgPDvEtFi24s4E
fdMyB6S/vjY7H67gHHXVSwKBgQC3m9mUQSQHpHq8wyS9vN4olG&#43;AQWxHw88uXYC&#43;
oUgbzI&#43;gh&#43;mp/ZawCKff0GurnvrALgkV1DON0SQYn4B1lL7P7SKLw5BCLrXmNZHg
Cp/eeegL19RpnOK3a1t/SQlbhV7cWw0ENPJX/HD7OocBwvszoouxvPmW/kWte5E2


SSH 连接是C/S模型，客户端发出连接申请，服务器对客户端进行验证，再考虑是否接受连接申请。
SSH认证过程
SSH提供了两种认证的方式, 分别为:
Password认证
即账号口令验证，SSH的实现方式是，

客户端向 ssh 服务器发出请求，服务器将自己的公钥返回给客户端；
客户端用服务器的公钥加密自己的登录密码，再将信息发送给服务器；
服务器接收到客户端传送的密码，用自己的私钥解码，如果结果正确，则同意登录，建立起连接。

这种方式还是存在漏洞，中间人可以假扮成服务器，骗取客户端的密码。而且在每次登陆的时候都需要输入密码，所以一般不采用该验证方式。
Public Key认证
Public Key认证利用公钥私钥对进行认证，在请求连接时不需要输入密码，并且由于整个请求连接和通信过程全程加密，因此安全性高。
SSH协议第二版中有RSA和DSA两种算法认证，其中RSA加密验证比较常用。
RSA加密验证方式，充分利用了非对称加密体系的优势，不需要在网络传输密码，完全杜绝了中间人攻击的可能。
认证的具体步骤如下:

准备工作


客户端先使用 ssh-keygen 命令，生成公钥和私钥。按照默认配置，私钥会被保存在~/.ssh/id_rsa中，公钥则在~/.ssh/id_rsa.pub中。
客户端通过安全的方式（一般通过scp/Secure Copy Protocol）方式或者U盘拷贝的方式)将公钥发送给服务器。在服务器端, 将客户端发的公钥写入到~/.ssh/authorized_keys文件末尾。（其实公钥和私钥不是必须在客户端生成, 在服务器端生成也是可以的, 在哪生成的对公钥和私钥并没有任何影响, 重要的是二者是配对的, 而准备阶段其实是要保证这么一个事实, 即服务器端握有公钥, 并在对应账户的家目录下的.ssh/authorized_keys文件中保存以便验证程序访问。请求端握有私钥。 至于为什么要将公钥和私钥这么分配, 接下来将会解释）


建立连接
在建立连接的时候，涉及到2对密钥，其中一对为准备阶段产生并分配好的密钥对，另一对为服务器在接收到一个连接请求时生成的密钥对。为了讲述方便，我们将这两组密钥对表示如下
|Symbol|Description|
|:-:|:-:|
|PubC|客户端密钥对应的公钥|
|PrvC|客户端握有的私钥|
|PubS|服务器端产生的公钥|
|PrvS|服务器端产生的私钥|



认证

服务器生成随机数（称之为challenge）x，并用PubC加密后生成结果s(x)，发送给客户端；
客户端使用PrvC解密s(x)得到x，再将x用PubS加密发送回服务器端；
服务器端使用PrvS解密得到x，进行核对, 如果正确则链接正式成立。



通信加密
在请求连接前，服务器端和客户端拥有的密钥为
|Server|Client|
|:-:|:-:|
|PubC|PrvC|

客户端发出申请。服务器会产生一组session密钥对，即PubS和PrvS。
此时服务器端和客户端拥有的密钥如下
|Server|Client|
|:-:|:-:|
|PubC|PrvC|
|PubS||
|PrvS||
服务器端利用客户端的公钥PubC对session公钥PubS进行加密后发送给客户端；
客户端用自己的密钥PrvC解密信息，得到session公钥PubS，此时服务器端和客户端拥有的密钥如下
|Server|Client|
|:-:|:-:|
|PubC|PubS|
|PubS|PrvC|
|PrvS||
之后的数据交互，都通过对方方公钥加密，对方收到信息后，用其私钥解密，实现安全加密过程。


"/>
<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "SSH简介",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/belldrum.com\/2020\/02\/0004-ssh-introduction\/"
        },"image": {
                "@type": "ImageObject",
                "url": "http:\/\/belldrum.com\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "Linux","wordcount":  2679 ,
        "url": "http:\/\/belldrum.com\/2020\/02\/0004-ssh-introduction\/","datePublished": "2020-02-12T21:24:11\x2b08:00","dateModified": "2020-02-12T21:24:11\x2b08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
                "@type": "Organization",
                "name": "Gavin",
                "logo": {
                "@type": "ImageObject",
                "url": "http:\/\/belldrum.com\/logo.png",
                "width":  127 ,
                "height":  40 
                }
            },"description": ""
    }
    </script><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/css/lib/animate/animate.min.css"></head>
    <body><script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header animated bounceIn">
            <a href="http://belldrum.com/">晨钟暮鼓</a>
        </div>
        <div class="navbar-menu"><a class="menu-item" href="http://belldrum.com/posts" title="">文章</a><a class="menu-item" href="http://belldrum.com/tags" title="">标签</a><a class="menu-item" href="http://belldrum.com/categories" title="">分类</a><a class="menu-item" href="http://belldrum.com/about" title="">关于</a><a class="menu-item" href="http://belldrum.com/" title="English">主页</a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="切换主题"></i></a>
        </div>
    </div>
</nav><nav class="navbar-mobile">
    <div class="navbar-container">
        <div class="navbar-header">
            <div class="navbar-header-title animated bounceIn">
                <a href="http://belldrum.com/">晨钟暮鼓</a>
            </div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu"><a class="menu-item" href="http://belldrum.com/posts" title="">文章</a><a class="menu-item" href="http://belldrum.com/tags" title="">标签</a><a class="menu-item" href="http://belldrum.com/categories" title="">分类</a><a class="menu-item" href="http://belldrum.com/about" title="">关于</a><a class="menu-item" href="http://belldrum.com/" title="English">主页</a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="切换主题"></i></a>
        </div>
    </div>
</nav><main class="main">
                <div class="container"><article class="page"><h1 class="post-title animated flipInX">SSH简介</h1><div class="post-meta">
            <div class="post-meta-main"><a class="author" href="http://belldrum.com/" rel="author" target="_blank">
                    <i class="fas fa-user-circle fa-fw"></i>Gavin
                </a>&nbsp;<span class="post-category">收录于&nbsp;<i class="far fa-folder fa-fw"></i><a href="http://belldrum.com/categories/linux/">Linux</a>&nbsp;</span></div>
            <div class="post-meta-other"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-02-12>2020-02-12</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>约 2679 字&nbsp;
                <i class="far fa-clock fa-fw"></i>预计阅读 6 分钟&nbsp;<span id="/2020/02/0004-ssh-introduction/" class="leancloud_visitors" data-flag-title="SSH简介">
                        <i class="far fa-eye fa-fw"></i><span class=leancloud-visitors-count></span> 次阅读
                    </span>&nbsp;</div>
        </div><div class="post-content"><p>虽然一直在使用SSH连接服务器，但是对于SSH连接的原理却没有深究，只是大体了解是使用了非对称加密技术对传输信息进行了加密。搜资料的时候顺手翻到了一篇博文，介绍的还比较详细，特转载保存。本文转自<a href="https://fancyseeker.github.io/2013/12/30/ssh_overview/" target="_blank">链接</a>，作者是FancySeeker。<br>
本文主要介绍了SSH的连接认证原理以及SSH的配置和使用。</p>
<a class="post-dummy-target" id="ssh简要介绍"></a><h2>SSH简要介绍</h2>
<p>SSH的英文全称为Secure Shell，是IETF（Internet Engineering Task Force）的Network Working Group所制定的一族协议，其目的是要在非安全网络上提供安全的远程登录和其他安全网络服务。用于在主机之间建立起安全连接, 并加密传输内容, 以达到安全的远程访问, 操作以及数据传输的目的。</p>
<p>SSH主要有两个特点: 1. 安全性 2. 传输速度快</p>
<p>为什么要强调SSH的安全特性, 因为传统的网络服务程序，如 FTP、POP 和 Telnet 其本质上都是不安全的；因为它们在网络上用明文传送数据、用户帐号和用户口令，很容易受到中间人（man-in-the-middle）攻击方式的攻击。就是存在另一个人或者一台机器冒充真正的服务器接收用户传给服务器的数据，然后再冒充用户把数据传给真正的服务器。 而 SSH 是目前较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。透过 SSH 可以对所有传输的数据进行加密，也能够防止 DNS 欺骗和 IP 欺骗。</p>
<p>SSH的传输速度快是因为SSH传输的数据都是经过压缩的, 自然传输速度快。</p>
<a class="post-dummy-target" id="ssh认证原理"></a><h2>SSH认证原理</h2>
<p>在介绍SSH具体的认证原理之前, 先简单的介绍下关于公钥和密钥加密的概念。所谓的公钥加密（public-key cryptography），或非对称密钥加密（asymmetric key cryptography） 是一类广泛使用的加密算法。这类算法使用一对（pair）密钥即公钥（public key）和私钥（private key）。 其中公钥可以随便分发，只用于加密（encryption），私钥则只由一人持有，只用于解密。通过公钥加密过的密文使用密钥可以轻松解密, 但根据公钥来猜测私钥却十分困难。</p>
<p>因此, 我们可以很容易的发现这么一个事实, 一个消息在用公钥加密后, 哪怕在传输中被人截获, 如果没有私钥, 是无法解密获得其内容的, 只有拥有私钥的人才能成功解密消息。所以私钥应该由消息的接收方紧紧攥在手里, 不应让他人得知。</p>
<p>公钥加密的关键点在于，一方面，公钥加密是可逆的，但是不能用公钥推断出私钥。显然数学上，已知一个公钥是能够算出对应私钥的，但是只要设计足够好的加密算法（以及使用足够复杂的密钥对），使得不能在可以接受的时间内破译即可。</p>
<p>RSA是一种常见的公钥加密算法。RSA的工作原理依赖于如下事实：破译RSA私钥需要对某些极大的整数进行因数分解，而目前尚未找到快速的对极大整数作因数分解的算法。换言之，如果有人找到了这样的算法，那么全世界的 RSA 加密都会失效。</p>
<p>RSA是由Ron Rivest，Adi Shamir, Leonard Adleman三人在1978年首次提出的。三人并因此项工作荣获了2002年Turing Award。Rivest还是算法导论的作者之一，书中在31章对RSA系统的原理进行了简要说明，系统实现中利用到了数论中的Euler-Fermat theorem。</p>
<p>一个基于RSA的公钥大概如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAvSkEZ0fKXRqQ/DkjCfsAETsQgV8OR/RVQmwBk/J5IWoknf8Dr
y5kOs+1bnx9zaf8oIcVuXf0jRxTccLBOXiReFJE4aD2rWO33sqA0M4qP1ESYhsU4yokRA0IMDJ62JUv2cWVJg
GpeQriol2t7mH8E6aB8OiJ+NgRbh6+/0LbtQs40VA2+W5PtaBwT4sjv9LOHIdzQcsEeCM8MIHqmXHst7/JuVI
i7wLCxB7Ur8qtwZ2/Ii8Ckjfo6mikWmSh6mRMq9qn0FkMkPCcpm8o4f1zJWOuf+RnjPpopFTqIa8JssMHJMuQ
cCm3EHDkBHjLk/SkidWOzqOtSvUeGKieWiijuw== username@localhost.localdomain
</code></pre></td></tr></table>
</div>
</div><p>与之配对的私钥形如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAvSkEZ0fKXRqQ/DkjCfsAETsQgV8OR/RVQmwBk/J5IWoknf8D
ry5kOs+1bnx9zaf8oIcVuXf0jRxTccLBOXiReFJE4aD2rWO33sqA0M4qP1ESYhsU
4yokRA0IMDJ62JUv2cWVJgGpeQriol2t7mH8E6aB8OiJ+NgRbh6+/0LbtQs40VA2
+W5PtaBwT4sjv9LOHIdzQcsEeCM8MIHqmXHst7/JuVIi7wLCxB7Ur8qtwZ2/Ii8C
kjfo6mikWmSh6mRMq9qn0FkMkPCcpm8o4f1zJWOuf+RnjPpopFTqIa8JssMHJMuQ
cCm3EHDkBHjLk/SkidWOzqOtSvUeGKieWiijuwIBIwKCAQEAjITesx9jIJdkY5go
qFQOrbbZD6Wy1l27ra9RoRqF3k7ZX2z7bDEXQaGcuHm8iiUEzwVDVpOfuUg9/LyP
icdHffP4p5wk9dUMPxoWjHvk3pP/BwzNsBCtOd3LkYSVxXYji9SaroTkS0nqL3jK
WVAaV72FGVxJPINAJer0SJgQ7OJ7f0kZJYoPwG0VpMTLOsmulH7/M5e9i+kwDLmH
+TMvJ3y8gXjc/Sj5UqN/JQIY+h07UxYGvoju/isqFHh8OmahsjJ3Nb3QsUEkC/Kj
cKG2K+mUzTe/4/XQuqMadrjX82QF2b2gL+cdvUAwLn55boXmrtUzxEPo4xxiDNzY
AbYxSwKBgQDxIkaa+EPSJXYej/5YzJLJLVsnb9ygqe/0fM0x022J6Z+0Yq9AIwJ7
N7dvMgNSROLoJ17Oij/N7aoiAZy1KHg1vOoqx6T6BClay8I1+dOsbY6Fi0QbkZeI
Rr6CDueq5PBR8j/oghNhQeFfJUEICBFU6Z7+uFwxuAtQqqdFHyDhSwKBgQDI0nX6
Jz9oW+Y+dXAvhpL8Yln0R45ufiqatkTQgGbeZ70XlKeR7VzQiXecy/XDteJCMlnv
4BhjHL967nSAmrCza13I3eXIYxbzypeNC57bVVXM9BBTg5f4nWwTN+I8Gd/BA5Y8
mekQPBuSyAOp7ULAecjKZrD9Jhw1vybT/aYxUQKBgQDcdxv7ZqRoXMPEK+E7PrIX
BOWgZkYPPEkaC7RKz+8fAXwSo15mhmirK6BlqhGqTZxB+BwqjQcirWhZmxLuxeo/
wqo1vdiqEm7z7X5dPC8+kA1G5bqc3OJQtbV+OYNaaupZjQc6+pVgPDvEtFi24s4E
fdMyB6S/vjY7H67gHHXVSwKBgQC3m9mUQSQHpHq8wyS9vN4olG+AQWxHw88uXYC+
oUgbzI+gh+mp/ZawCKff0GurnvrALgkV1DON0SQYn4B1lL7P7SKLw5BCLrXmNZHg
Cp/eeegL19RpnOK3a1t/SQlbhV7cWw0ENPJX/HD7OocBwvszoouxvPmW/kWte5E2
</code></pre></td></tr></table>
</div>
</div><p>SSH 连接是<code>C/S</code>模型，客户端发出连接申请，服务器对客户端进行验证，再考虑是否接受连接申请。</p>
<a class="post-dummy-target" id="ssh认证过程"></a><h2>SSH认证过程</h2>
<p>SSH提供了两种认证的方式, 分别为:</p>
<a class="post-dummy-target" id="password认证"></a><h3>Password认证</h3>
<p>即账号口令验证，SSH的实现方式是，</p>
<ol>
<li>客户端向 ssh 服务器发出请求，服务器将自己的公钥返回给客户端；</li>
<li>客户端用服务器的公钥加密自己的登录密码，再将信息发送给服务器；</li>
<li>服务器接收到客户端传送的密码，用自己的私钥解码，如果结果正确，则同意登录，建立起连接。</li>
</ol>
<p>这种方式还是存在漏洞，中间人可以假扮成服务器，骗取客户端的密码。而且在每次登陆的时候都需要输入密码，所以一般不采用该验证方式。</p>
<a class="post-dummy-target" id="public-key认证"></a><h3>Public Key认证</h3>
<p>Public Key认证利用公钥私钥对进行认证，在请求连接时不需要输入密码，并且由于整个请求连接和通信过程全程加密，因此安全性高。<br>
SSH协议第二版中有RSA和DSA两种算法认证，其中RSA加密验证比较常用。<br>
RSA加密验证方式，充分利用了非对称加密体系的优势，不需要在网络传输密码，完全杜绝了中间人攻击的可能。<br>
认证的具体步骤如下:</p>
<ul>
<li><strong>准备工作</strong></li>
</ul>
<ol>
<li>客户端先使用 ssh-keygen 命令，生成公钥和私钥。按照默认配置，私钥会被保存在<code>~/.ssh/id_rsa</code>中，公钥则在<code>~/.ssh/id_rsa.pub</code>中。</li>
<li>客户端通过安全的方式（一般通过scp/Secure Copy Protocol）方式或者U盘拷贝的方式)将公钥发送给服务器。在服务器端, 将客户端发的公钥写入到<code>~/.ssh/authorized_keys</code>文件末尾。（其实公钥和私钥不是必须在客户端生成, 在服务器端生成也是可以的, 在哪生成的对公钥和私钥并没有任何影响, 重要的是二者是配对的, 而准备阶段其实是要保证这么一个事实, 即服务器端握有公钥, 并在对应账户的家目录下的<code>.ssh/authorized_keys</code>文件中保存以便验证程序访问。请求端握有私钥。 至于为什么要将公钥和私钥这么分配, 接下来将会解释）</li>
</ol>
<ul>
<li><strong>建立连接</strong><br>
在建立连接的时候，涉及到2对密钥，其中一对为准备阶段产生并分配好的密钥对，另一对为服务器在接收到一个连接请求时生成的密钥对。为了讲述方便，我们将这两组密钥对表示如下<br>
|Symbol|Description|<br>
|:-:|:-:|<br>
|PubC|客户端密钥对应的公钥|<br>
|PrvC|客户端握有的私钥|<br>
|PubS|服务器端产生的公钥|<br>
|PrvS|服务器端产生的私钥|</li>
</ul>
<ol>
<li>
<p><strong>认证</strong></p>
<ol>
<li>服务器生成随机数（称之为challenge）<code>x</code>，并用<code>PubC</code>加密后生成结果<code>s(x)</code>，发送给客户端；</li>
<li>客户端使用<code>PrvC</code>解密<code>s(x)</code>得到<code>x</code>，再将<code>x</code>用<code>PubS</code>加密发送回服务器端；</li>
<li>服务器端使用<code>PrvS</code>解密得到<code>x</code>，进行核对, 如果正确则链接正式成立。</li>
</ol>
</li>
<li>
<p><strong>通信加密</strong><br>
在请求连接前，服务器端和客户端拥有的密钥为<br>
|Server|Client|<br>
|:-:|:-:|<br>
|PubC|PrvC|</p>
<ol>
<li>客户端发出申请。服务器会产生一组<code>session</code>密钥对，即<code>PubS</code>和<code>PrvS</code>。<br>
此时服务器端和客户端拥有的密钥如下<br>
|Server|Client|<br>
|:-:|:-:|<br>
|PubC|PrvC|<br>
|PubS||<br>
|PrvS||</li>
<li>服务器端利用客户端的公钥<code>PubC</code>对<code>session</code>公钥<code>PubS</code>进行加密后发送给客户端；</li>
<li>客户端用自己的密钥<code>PrvC</code>解密信息，得到<code>session</code>公钥<code>PubS</code>，此时服务器端和客户端拥有的密钥如下<br>
|Server|Client|<br>
|:-:|:-:|<br>
|PubC|PubS|<br>
|PubS|PrvC|<br>
|PrvS||</li>
<li>之后的数据交互，都通过对方方公钥加密，对方收到信息后，用其私钥解密，实现安全加密过程。</li>
</ol>
</li>
</ol></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>本文于 2020-02-12 更新</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><span><a href="//twitter.com/share?url=http%3a%2f%2fbelldrum.com%2f2020%2f02%2f0004-ssh-introduction%2f&amp;text=SSH%e7%ae%80%e4%bb%8b&amp;via=" target="_blank" title="分享到 Twitter">
            <i class="fab fa-twitter fa-fw"></i>
        </a><a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fbelldrum.com%2f2020%2f02%2f0004-ssh-introduction%2f" target="_blank" title="分享到 Facebook">
            <i class="fab fa-facebook-square fa-fw"></i>
        </a><a href="//reddit.com/submit?url=http%3a%2f%2fbelldrum.com%2f2020%2f02%2f0004-ssh-introduction%2f&amp;title=SSH%e7%ae%80%e4%bb%8b" target="_blank" title="分享到 Reddit">
            <i class="fab fa-reddit fa-fw"></i>
        </a></span></div>
        </div>
    </div>

    <div class="post-info-more">
        <section><span class="tag">
                        <a href="http://belldrum.com/tags/linux/"><i class="fas fa-tag fa-fw"></i>&nbsp;Linux</a>&nbsp;
                    </span></section>
        <section>
            <span><a href="javascript:window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="http://belldrum.com/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="http://belldrum.com/2020/02/0003-ali-cloud-server/" class="prev" rel="prev" title="Ali云服务器配置"><i class="fas fa-angle-left fa-fw"></i>Ali云服务器配置</a>
            <a href="http://belldrum.com/2020/02/0005-linux-user-management/" class="next" rel="next" title="Linux文件与用户管理">Linux文件与用户管理<i class="fas fa-angle-right fa-fw"></i></a></div>
</div><div class="post-comment"><div id="vcomments"></div><script src="/js/lib/valine/Valine.min.min.js"></script><script type="text/javascript">
            (function () {
                
                
                if (window.location.hostname == "localhost")
                    return;
                new Valine({
                    el: "#vcomments",
                    appId: "wi2zHvTM3ahn6m8dCA1YUV0u-gzGzoHsz",
                    appKey: "IotWRV7YPP7EeVVFGMicGR0S",
                    meta: ["nick", "mail"],
                    notify: "false",
                    verify: "true",
                    avatar: "mp",
                    placeholder: "你的评论 ...",
                    visitor: "true",
                    recordIP: "true",
                    lang: "zh-cn",
                });
            })();
        </script></div>
    </article></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="http://belldrum.com/" target="_blank">Gavin</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                <span class="icp"><a href="http://www.beian.miit.gov.cn" target="_blank">鲁ICP备20005030-1</a></span><span class="copyright-line">
				&nbsp;|&nbsp;Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> & <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt</a>
			</span>
		</div>
    </div>
</footer></div><a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll>
            <span>&nbsp;</span>
        </a><script src="/js/lib/jquery/jquery.slim.min.js"></script><script src="/js/lib/lazysizes/lazysizes.min.js"></script><script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script><script src="/js/blog.min.js"></script></body>
</html>